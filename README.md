# üï∂Ô∏è BlackBox (SQL Version)

> _What goes in, stays in._

[![Deployed via GitHub Actions](https://img.shields.io/badge/Deployed%20via-GitHub%20Actions-blue?logo=github)](https://github.com/junaid-mohammad/BlackBox)
[![Azure App Service](https://img.shields.io/badge/Hosted%20on-Azure%20App%20Service-brightgreen)](https://blackbox-d6g2c2dycya8fgbs.canadacentral-01.azurewebsites.net/)
[![Azure DevOps](https://img.shields.io/badge/Tracked%20in-Azure%20DevOps-blue)](https://dev.azure.com/Junaid-Arif/BlackBox)

**BlackBox (SQL Version)** is a full-stack authentication playground built to showcase modern authentication flows and security practices using **Node.js**, **Express**, and **PostgreSQL**.
Originally a MongoDB project, it has been fully re-architected to use relational data storage with **Azure PostgreSQL Flexible Server** and **Azure App Service** for deployment.
The app walks through seven levels of authentication challenges, from basic username/password logins to OAuth 2.0 integration and user-generated secret submissions. Each level reinforces concepts like hashing, salting, session security, and modular architecture ‚Äî making it a robust playground for both learning and demonstrating secure authentication patterns.

---

## üó∫Ô∏è Live Application

üëâ **[BlackBox App](https://blackbox-d6g2c2dycya8fgbs.canadacentral-01.azurewebsites.net/)**
üëâ **[GitHub Repository](https://github.com/junaid-mohammad/BlackBox)**
üëâ **[Azure DevOps Project](https://dev.azure.com/Junaid-Arif/BlackBox)**

---

## üéØ Purpose

**BlackBox (SQL Version)** was created to explore and master secure authentication techniques within a full-stack environment.
The goal was to build a learning-focused playground that not only demonstrates core authentication concepts, but also integrates best practices for modular architecture, database security, and user experience.

This project:

- **Reinforces security fundamentals** through hands-on implementation of encryption, hashing, and session-based login.
- **Practices modular backend design** by separating routes, controllers, and database interactions for clarity and maintainability.
- **Simulates real-world scenarios** with multi-layered authentication, user data management, and external OAuth integration.
- **Provides a testbed** for learning how to connect relational databases to modern Node.js applications.

The journey from a MongoDB-based sandbox to a fully-fledged PostgreSQL-powered application taught me everything from **SQL queries** and **hashing pitfalls** to **OAuth 2.0 best practices** and **secure session handling** ‚Äî all while deploying to **Azure App Service**.

---

## üîê Authentication Levels

This SQL branch of **BlackBox** tackles authentication step by step:

1. ‚úÖ **Level 1: Register & Log In using Email & Password**

   - Simple form-based authentication with PostgreSQL storage.
   - Validates credentials and logs in the user ‚Äî no hashing yet.

2. ‚úÖ **Level 2: Encryption & Hashing Concepts**

   - Explored why passwords shouldn‚Äôt be encrypted (need a key) and should be **hashed** instead.
   - Learned about symmetric vs. asymmetric encryption, hashing (MD5, SHA), and brute force risks.
   - No actual encryption code here ‚Äî purely conceptual, to build a foundation.

3. ‚úÖ **Level 3: Hashing and Salting with bcrypt**

   - Implemented `bcrypt` hashing and 10 rounds of salting.
   - Passwords stored as irreversible hashes ‚Äî no plain text anywhere.
   - Validated passwords during login with `bcrypt.compare`.

4. ‚úÖ **Level 4: Sessions and Cookies with Passport**

   - Integrated `express-session` for session management and cookie handling.
   - Added `passport-local` strategy for secure username/password login.
   - Configured `serializeUser` and `deserializeUser` to store and retrieve user session data.

5. ‚úÖ **Level 5: Environment Variables & Security**

   - Stored all sensitive data (DB credentials, API keys) in `.env` and Azure App Settings.
   - Learned how environment variables boost both security and scalability.
   - No code changes needed as the project already used `.env` ‚Äî confirmed best practices.

6. ‚úÖ **Level 6: Google OAuth 2.0 Authentication**

   - Added social login with Google using `passport-google-oauth2`.
   - Configured routes for Google‚Äôs OAuth flow: `/auth/google` and callback.
   - Google profile data securely stored and integrated with local user sessions.

7. ‚úÖ **Level 7: Anonymous Secret Submission**

   - Created a separate `secrets` table for storing multiple secrets per user.
   - Users can add **many** secrets anonymously (instead of overwriting).
   - Secrets are displayed only to the logged-in user, ensuring privacy and ownership.

---

## üíª Tech Stack

- **Frontend:**

  - **EJS** for dynamic, server-side rendering
  - **Bootstrap 4** for responsive styling
  - **FontAwesome** for rich iconography

- **Backend:**

  - **Node.js** runtime environment
  - **Express.js** for fast, minimalist web server routing
  - **bcrypt** for secure password hashing
  - **passport** and **passport-google-oauth2** for modular authentication

- **Database:**

  - **PostgreSQL** ‚Äî relational database for robust data management
  - Queries and schema designed for multi-secret support and secure credential storage

- **Deployment & Hosting:**

  - **Azure App Service** ‚Äî scalable cloud hosting platform
  - **Azure PostgreSQL Flexible Server** for secure, managed database hosting
  - **Environment variables** managed through `.env` locally and **Azure App Settings** in production
  - **GitHub Actions** for continuous deployment (CD) to Azure

---

## üß† What I Learned

This project was a deep dive into **authentication best practices**, **secure user data handling**, and **scalable, cloud-ready deployment**.
Here‚Äôs what stood out:

- How to **modularize** a Node.js application for maintainability:
  separating routes, controllers, DB logic, and Passport config into clean files.
- The difference between **encryption** (reversible) and **hashing** (one-way) ‚Äî why hashing is key for passwords.
- **Salting** with bcrypt to strengthen password security and defeat rainbow table attacks.
- The role of **sessions** and **cookies** in authenticating users and preserving state.
- Integrating **OAuth 2.0** (Google) in real-world login flows and storing third-party profiles securely.
- How to manage **environment variables** across local and cloud environments for both **security** and **flexibility**.
- Cloud deployment challenges: configuring environment-specific DB connections, enabling SSL in production, and using **Azure App Service** with a **PostgreSQL Flexible Server** backend.
- The value of **iterative learning** ‚Äî each level built on the last, reinforcing how real-world authentication systems evolve.

---

## üöÄ Deployment & Workflow

The app is deployed on **Azure App Service** with a **PostgreSQL Flexible Server** for persistent data storage. Local development uses a `.env` file to store environment-specific credentials, while **Azure App Settings** handle production secrets securely.

Automated deployments are powered by **GitHub Actions**. Pushing to the `sql-version` branch triggers workflows that build and deploy the app directly to Azure, ensuring smooth CI/CD pipelines.

For detailed instructions on setting up the Azure PostgreSQL Flexible Server (firewall, SSL, psql commands), see the [**Deployment Section in Capitalism**](https://github.com/junaid-mohammad/Capitalism#-deployment--workflow).

---

### üõ†Ô∏è Getting Started

To **run BlackBox locally** or replicate this setup:

1. **Clone the repo:**

   ```bash
   git clone https://github.com/junaid-mohammad/BlackBox.git
   cd BlackBox
   ```

2. **Switch to the SQL branch:**

   ```bash
   git checkout sql-version
   ```

3. **Install dependencies:**

   ```bash
   npm install
   ```

4. **Set up your `.env` file** (for local or Azure Postgres Flexible Server):

   ```env
   DB_USER=your_db_username
   DB_HOST=your_db_host
   DB_NAME=your_db_name
   DB_PASSWORD=your_db_password
   DB_PORT=5432
   SESSION_SECRET=your_random_session_secret
   CLIENT_ID=your_google_client_id
   CLIENT_SECRET=your_google_client_secret
   CALLBACK_URL=your_google_client_callback_url
   ```

5. **Create the PostgreSQL database tables:**

   ```sql
   -- users table
   CREATE TABLE users (
     id SERIAL PRIMARY KEY,
     email TEXT UNIQUE NOT NULL,
     password TEXT NOT NULL
   );

   -- secrets table
   CREATE TABLE secrets (
     id SERIAL PRIMARY KEY,
     user_id INTEGER REFERENCES users(id),
     content TEXT
   );
   ```

6. **Start the server locally:**

   ```bash
   npm run dev
   ```

7. **Visit in browser:**

   ```
   http://localhost:3000
   ```

---

## ‚òÅÔ∏è Hosting & Infrastructure

- **Hosting:**

  - **Azure App Service** serves the Node.js + EJS app, handling both static and dynamic routes.
  - **Azure PostgreSQL Flexible Server** stores user credentials and secrets.

- **Production SSL:**

  - SSL is **enforced** in production, ensuring encrypted connections to the database:

    ```js
    ssl: process.env.NODE_ENV === "production"
      ? { rejectUnauthorized: false }
      : false;
    ```

---

## ‚öôÔ∏è Local & Cloud Environments

- **Local:**

  - `.env` file contains credentials for local Postgres.
  - No SSL is enforced in dev mode.

- **Production:**

  - Azure securely manages environment variables.
  - SSL is **automatically required** for secure DB connections.

---

Got it! Here‚Äôs the **corrected section**:

---

## üîÅ CI/CD and Azure DevOps Integration

- **GitHub Actions:**
  Pushing to the `main` branch triggers automated deployment to **Azure App Service** via **GitHub Actions**. This ensures continuous delivery of updates and consistent deployment practices.

- **Azure DevOps:**
  Configured as a secondary remote for **redundancy and future pipeline integration** (no active pipelines in use):

  ```bash
  git remote add azure https://Junaid-Arif@dev.azure.com/Junaid-Arif/BlackBox/_git/BlackBox
  git push azure main
  ```

---

## üß™ Database Management

The app uses two core tables:

1. **users table:**

   ```sql
   CREATE TABLE users (
     id SERIAL PRIMARY KEY,
     email TEXT UNIQUE NOT NULL,
     password TEXT NOT NULL
   );
   ```

2. **secrets table:**

   ```sql
   CREATE TABLE secrets (
     id SERIAL PRIMARY KEY,
     user_id INTEGER REFERENCES users(id),
     content TEXT
   );
   ```

No additional migrations or seeders were needed ‚Äî just initial table setup. For detailed Azure PostgreSQL provisioning, see the [**Capitalism Deployment Guide**](https://github.com/junaid-mohammad/Capitalism#-deployment--workflow).

---

## üóÇ Project Structure

```bash
üì¶ BlackBox/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ passport.js            # All Passport strategies and session config
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ secretController.js    # Controller logic for user authentication and secret handling
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ secretRoutes.js        # Routes delegated to the controller
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ db.js                  # PostgreSQL client setup (with SSL for production)
‚îú‚îÄ‚îÄ views/                     # EJS templates for all dynamic pages
‚îú‚îÄ‚îÄ public/                    # Static assets (CSS, images, client-side JS)
‚îú‚îÄ‚îÄ index.js                   # Main Express entry point and app configuration
‚îú‚îÄ‚îÄ .env                       # Local environment variables (Azure App Settings used in production)
‚îú‚îÄ‚îÄ package.json               # Project dependencies and scripts
‚îî‚îÄ‚îÄ README.md                  # Project documentation
```

---

## ü§ù Contribution

**BlackBox** is a personal learning project ‚Äî designed to explore modern authentication flows, relational database integration, and full-stack deployment pipelines. If you‚Äôd like to fork it, replicate the stack, or build on it, please do! Contributions are welcome for:

- UI/UX improvements
- Additional authentication flows (e.g., social logins beyond Google)
- Deployment optimizations
- Additional features like password reset flows or admin panels

---

## üìÑ License

This project is licensed under the **MIT License** ‚Äî open-source and freely available for others to use, learn from, or expand upon.

---

## üîó Credits

- Originally a learning exercise to understand authentication workflows with **PostgreSQL**, **Node.js**, and **Express**.
- Modular design and deployment practices inspired by my earlier projects like **Capitalism** and **Todo Or Not Todo**.
- Created with ‚òï, üî•, and a lot of enthusiasm by [**Junaid Arif**](https://github.com/junaid-mohammad), and deployed using **Azure App Service** and **GitHub Actions**.

---
